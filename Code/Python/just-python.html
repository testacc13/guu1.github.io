<!DOCTYPE html>
<html>
<title>Just python</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><style>
body {font-family: "Roboto", sans-serif}
.w3-sidenav a {padding:16px;font-weight:bold}
</style>
<body>

<nav class="w3-sidenav w3-collapse w3-text-black w3-hover-text-black w3-animate-left w3-card-2" style="z-index:3;width:250px;" id="mySidenav">
  <!--<a href="#" class="w3-border-bottom w3-large"><img src="http://www.w3schools.com/images/w3schools.png" style="width:80%;"></a>-->
  <a href="javascript:void(0)" onclick="w3_close()" 
  class="w3-text-teal w3-hide-large w3-closenav w3-large">Close <i class="fa fa-remove"></i></a>

  <a href="../../index.html" class="w3-light-grey w3-medium"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
  <a href="../Python/just-python.html"><i class="fa fa-code" aria-hidden="true"></i> Python</a>
    <div class="w3-accordion">
    <a onclick="myAccordion('demo')" href="javascript:void(0)"><i class="fa fa-server" aria-hidden="true"></i> Networking <i class="fa fa-caret-down"></i></a>
    <div id="demo" class="w3-accordion-content w3-animate-left w3-padding">
      <a href="../Networking/protocols.html">Protocols</a>
      <!--<a href="../Networking/apache.html">Apache</a>-->
      
    </div>
  </div>
  <a href="../Casm/casm.html" ><i class="fa fa-code" aria-hidden="true"></i> C/ASM</a>
  <a href="../Linux/linux.html"><i class="fa fa-linux" aria-hidden="true"></i> Linux</a>
  <a href="../../posts.html"><i class="fa fa-camera" aria-hidden="true"></i> Photography</a>
  <a href="../../Gaming/gaming.html"><i class="fa fa-gamepad" aria-hidden="true"></i> Gaming</a>
  <a href="../../about.html"><i class="fa fa-user-circle" aria-hidden="true"></i> About</a>

</nav>
</nav>

<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" id="myOverlay"></div>

<div class="w3-main" style="margin-left:250px;">

	<div id="myTop" class="w3-top w3-container w3-padding-16 w3-theme w3-large">
	  <i class="fa fa-bars w3-opennav w3-hide-large w3-xlarge w3-margin-left w3-margin-right" onclick="w3_open()"></i>
	  <span id="myIntro" class="w3-hide">Python</span>
	</div>

	<header class="w3-container w3-theme w3-padding-64" style="padding-left:32px">
	  <h1 class="w3-xxxlarge w3-padding-16">Just python</h1>
	  <a style="text-decoration: none; font-family: Verdana;" href="https://twitter.com/awdasdqwert">My Twitter Bot  <span></a><i class="fa fa-twitter" aria-hidden="true"></i>

	</header>

	<div class="w3-container w3-padding-32" style="padding-left:32px">
	
	<article>
		<h2>Socket chat</h2>
		<p>Terminal based socket chat (for linux) for multiple client connections. I'm thinking about implementing it in here to create some sort of chat. </p>
		<h3> Server </h3>
		<pre>


		import socket, argparse, threading

		 # Accept a new socket and receive the nickname
		def socket_accept():
			
			conn, address = s.accept() # Three-way handshake - This is a TCP connection with the server
			# Receive the nickname
			nickname = conn.recv(1024)
			# Append address in clients list
			if address not in clients:
				#clients.append((address[0]+':'+str(address[1])))
				clients.append(conn)
			print("Connection has been established | " + "IP " + address[0] + \
				" | Port " + str(address[1]) + ' ' + nickname)
			#client(conn)
			#conn.close()
			# Go for data
			# Start a thread to keep receiving client data
			thread_client = threading.Thread(target = data, args=[nickname, conn])
			thread_client.start()

		def data(nickname, conn):
			while True:	
				# Reveive the data from client
				data = conn.recv(4096)
				#conn.sendall(data)
				if data:
					print("%s said %s" % (nickname, repr(data)))
					bcast(conn, data, nickname) # Call for broadcast
								    # I tried to put this function here instead of
								    # calling it but it don't work because it's
								    # always on the same client socket and we 
								    # need to change socket to send to other clients
								    # sendto(data, address) also didn't work
				if not data:	
					break

		 # Broadcast 
		def bcast(client_socket, message, client_nickname):
			# We don't want to receive what we sent	
			for i in clients:
				if i == client_socket:
					pass
				# Sent my message to other clients
				else:
					print(clients)
					#i.sendall(client_nickname)
					#i.sendall()
					# New line on the client side
					i.sendall(client_nickname + ': ' + message)	

		if __name__ == '__main__':
			# Args for host and port
			parser = argparse.ArgumentParser(description='My TCP server')
			parser.add_argument('host',  help='Interface the server listens at')
			parser.add_argument('-p', metavar='PORT', type=int, help='TCP PORT (default 9999)')	
			args = parser.parse_args()
			host = args.host
			port = args.p

			 # Client List	
			clients = []

			 # Create socket
			try:
				s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
				s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR,1)
			except socket.error as msg:
				print("Socket creation error: " + str(msg))

			 # Bind the sockets
			try:
				print("Binding socket to port: " + str(port))
				s.bind((host, port))
				s.listen(5) #number of connections
			except socket.error as msg:
				print("Socket binding error: " + str(msg) + "\n" + "Retrying...")


			
			while True:
				socket_accept()
		</pre>
		
		<h3> Client </h3>

		<pre>


		import socket, sys, argparse, threading

		# Function to send data
		def send():
			global my_nickname
			while True:
				message = raw_input(my_nickname + ' :')
				sock.sendall(message)
				if message == 'quit':
					#break
					sock.close()
					sys.stdout.flush()
					sys.exiti(0)

		# Function to receive data
		def receive():
			while True:
				data = sock.recv(4096)
				# New line for when receiving data from other clients
				print('\n' + data)
				if not data:
					break



		if __name__ == '__main__':

			 # Args for host and port
			parser = argparse.ArgumentParser(description='My TCP server')
			parser.add_argument('host',  help='server to connect to')
			parser.add_argument('-p', metavar='PORT', type=int, help='TCP PORT (default 9999)')      
			args = parser.parse_args()
			host = args.host
			port = args.p

			 # Create the socket AF_INET the internet family of protocols IPv4
			 # SOCK_STEAM TCP PROTOCOL
			sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

			try:
			sock.connect((host,port))
			except:
			print('Can\'t connect')
			sock.close()
			sys.exit()

			# Sends nickname to server
			my_nickname = raw_input('Choose nick: ')    
			sock.sendall(my_nickname)

			# A thread for send and receive
			thread_send = threading.Thread(target = send)
			thread_send.start()
			thread_receive =  threading.Thread(target = receive)
			thread_receive.start()

		</pre>
	

	</article>
	<hr>


	<article>
		<h3>Endless screaming</h3>
		<img src="https://gpzdza.bn1301.livefilestore.com/y3mUe_s5RI8eVa9AsPje3YJg35ovRfcGbwyx0Rp2ZjEDu9KlOiWBNEg_PLP639ar_h-99My0fLld0YEnDtBj8pcaeRSsWPm8bRXgIzYGMFIfRY6zm_4tPyewl5OkLfHFjisHbmin_SVnrQ4iH0sHoHVQ_lp1uMiz43f_ZX66wR9Yk8?width=674&height=548&cropmode=none">
		<p>python</p>
		<img src="https://gpb42a.bn1301.livefilestore.com/y3mPDCWq_fsOVVmeGJ6iqZvLkHZ3C-Hg2nEye7d4emrcnvm5PNXiSGP22d7gpIm-hb6VVh-JNyB_1_4w-gnkS7Utuk3xUQzGQBqhMeU_YVbCkigAPmSh2ayUoKAaXlAEcTJuk4SZNCgFNoeMvsMLQ1EHMXsyadm6_m-_8RjRFDYH5k?width=670&height=185&cropmode=none">
	</article>


		<hr>
			
	<br>
	</div>

		<footer class="w3-container w3-theme w3-padding-32" style="padding-left:32px">
	  		<address style="color:white;">Apache/2.4.25 (Unix) Server on raspberrypi at brainpasta.ddns.net Port 80</address>
	  	</footer>   
</div>

<script>
// Open and close the sidenav on medium and small screens
function w3_open() {
    document.getElementById("mySidenav").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
}
function w3_close() {
    document.getElementById("mySidenav").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}

// Change style of top container on scroll
window.onscroll = function() {myFunction()};
function myFunction() {
    if (document.body.scrollTop > 80 || document.documentElement.scrollTop > 80) {
        document.getElementById("myTop").classList.add("w3-card-4", "w3-animate-opacity");
        document.getElementById("myIntro").classList.add("w3-show-inline-block");
    } else {
        document.getElementById("myIntro").classList.remove("w3-show-inline-block");
        document.getElementById("myTop").classList.remove("w3-card-4", "w3-animate-opacity");
    }
}

// Accordions
function myAccordion(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
        x.previousElementSibling.className += " w3-theme";
    } else { 
        x.className = x.className.replace("w3-show", "");
        x.previousElementSibling.className = 
        x.previousElementSibling.className.replace(" w3-theme", "");
    }
}
</script>
     
</body>
</html> 